<!DOCTYPE html>
<html lang="ar" dir="rtl" data-theme="luxury">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title id="pageTitle">ÙƒØªØ§Ù„ÙˆØ¬ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª - Ø¬Ø§Ù„ Ù„Ù„ØªØ¬Ø§Ø±Ø©</title>
    <link rel="icon" type="image/webp" href="/images/logo.webp">
    <link rel="apple-touch-icon" href="/images/logo.webp">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.x/dist/full.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link rel="stylesheet" href="/css/productCatalog.css">
    <style>
        body {
            font-family: "Cairo", sans-serif;
        }
        .gold-text {
            color: #d4af37;
        }
        .cart-badge {
            position: absolute;
            top: -8px;
            inset-inline-end: -8px;
            background: #dc2626;
            color: white;
            border-radius: 50%;
            padding: 4px 8px;
            font-size: 12px;
            font-weight: bold;
            min-width: 20px;
            text-align: center;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        .dropdown .cart-badge {
            top: 0;
            inset-inline-end: 0;
            transform: translate(50%, -50%);
        }
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .product-image-container,
        .category-image-container {
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.1) 0%, rgba(255, 215, 0, 0.05) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 200px;
            border-radius: 12px;
            overflow: hidden;
        }
        .category-image-container {
            height: 96px;
        }
        .product-image,
        .category-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
            object-position: center;
            transition: transform 0.3s ease;
        }
        .product-card:hover .product-image {
            transform: scale(1.05);
        }
        .category-card:hover .category-image {
            transform: scale(1.1);
        }
        .glass-card {
            background: rgba(17, 25, 40, 0.75);
            backdrop-filter: blur(16px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.125);
        }
        .search-btn {
            background: linear-gradient(135deg, #d4af37 0%, #ffd700 100%);
            color: #1a1a2e;
            border: none;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(212, 175, 55, 0.3);
        }
        .active-category {
            position: relative;
            overflow: hidden;
        }
        .active-category::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #d4af37, #ffd700);
        }
        .language-switcher {
            transition: all 0.3s ease;
        }
        .language-switcher:hover {
            transform: scale(1.05);
        }
        .pagination-btn {
            transition: all 0.3s ease;
        }
        .pagination-btn:hover:not(:disabled) {
            transform: translateY(-2px);
        }
        .product-count-badge {
            background: linear-gradient(135deg, #d4af37 0%, #ffd700 100%);
            color: #1a1a2e;
        }
        .loading-spinner {
            border: 3px solid rgba(212, 175, 55, 0.3);
            border-top: 3px solid #d4af37;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .toast-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„ØªÙˆØ§ÙÙ‚ÙŠØ© Ø¨ÙŠÙ† Ø§Ù„Ù„ØºØ§Øª */
        [dir="rtl"] .text-left {
            text-align: right;
        }
        [dir="ltr"] .text-left {
            text-align: left;
        }
        .language-sensitive {
            transition: all 0.3s ease;
        }
        /* Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø¹Ù„Ø§Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ - ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ù…ÙˆÙ‚Ø¹Ù‡ */
        .flags-bar {
            position: absolute;
            bottom: 0;
            right: 0;
            left: 0;
            height: 24px;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 8px;
            gap: 8px;
            z-index: 10;
            border-radius: 0 0 12px 12px;
        }
        .flag-icon {
            width: 20px;
            height: 14px;
            border-radius: 2px;
            object-fit: cover;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
            transition: transform 0.2s ease;
        }
        .flag-icon:hover {
            transform: scale(1.2);
        }
    </style>
</head>
<body class="bg-base-100">

<!-- Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ù…Ø­Ø³Ù† -->
<header class="navbar bg-base-100 shadow-lg sticky top-0 z-50 px-4 border-b border-[#d4af37]/20" x-data="headerManager()">
    <div class="flex-1">
        <a href="/" class="flex items-center gap-3 hover:scale-105 transition-transform duration-300">
            <img src="/images/logo.webp" alt="Ø´Ø¹Ø§Ø± Ø¬Ø§Ù„ Ù„Ù„ØªØ¬Ø§Ø±Ø©" class="navbar-logo rounded-lg" style="width:50px;">
            <span id="brandName" class="text-xl md:text-2xl font-bold gold-text">Ø¬Ø§Ù„ Ù„ØªÙˆØ±ÙŠØ¯Ø§Øª Ø§Ù„Ù…ØµØ§Ù†Ø¹</span>
        </a>
    </div>

    <!-- Ù‚Ø§Ø¦Ù…Ø© Desktop Ø§Ù„Ù…Ø­Ø³Ù†Ø© -->
    <nav class="hidden md:flex gap-2">
        <a href="/productCatalog" class="btn btn-ghost btn-sm rounded-xl hover:bg-[#d4af37]/10 hover:text-[#d4af37] transition-all duration-300">
            <i class="fas fa-box-open ml-1"></i> <span id="navProducts">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</span>
        </a>
        <a href="/cart" class="btn btn-ghost btn-sm rounded-xl hover:bg-[#d4af37]/10 hover:text-[#d4af37] transition-all duration-300 relative">
            <i class="fas fa-shopping-cart ml-1"></i>
            <span id="navCart">Ø§Ù„Ø³Ù„Ø©</span>
            <span x-show="cartCount > 0" x-cloak class="cart-badge" x-text="cartCount"></span>
        </a>
        <a href="/contact" class="btn btn-ghost btn-sm rounded-xl hover:bg-[#d4af37]/10 hover:text-[#d4af37] transition-all duration-300">
            <i class="fas fa-phone-alt ml-1"></i> <span id="navContact">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</span>
        </a>
    </nav>

    <!-- Dropdown Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ Ø§Ù„Ù…Ø­Ø³Ù† -->
    <div class="dropdown dropdown-end md:hidden relative">
        <button tabindex="0" class="btn btn-ghost btn-lg rounded-xl hover:bg-[#d4af37]/10 hover:text-[#d4af37] transition-all duration-300">
            <i class="fas fa-bars text-2xl"></i>
        </button>
        <ul tabindex="0" class="menu menu-lg dropdown-content mt-3 shadow-2xl glass-card rounded-2xl w-64 z-[100] p-3 text-lg font-semibold border border-[#d4af37]/30">
            <li>
                <a href="/productCatalog" class="py-4 rounded-xl hover:bg-[#d4af37]/10 hover:text-[#d4af37] transition-all duration-300">
                    <i class="fas fa-box-open ml-2 text-xl"></i> <span id="mnavProducts">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</span>
                </a>
            </li>
            <li>
                <a href="/cart" class="py-4 rounded-xl hover:bg-[#d4af37]/10 hover:text-[#d4af37] transition-all duration-300 relative">
                    <i class="fas fa-shopping-cart ml-2 text-xl"></i>
                    <span id="mnavCart">Ø§Ù„Ø³Ù„Ø©</span>
                    <span x-show="cartCount > 0" x-cloak class="cart-badge" x-text="cartCount"></span>
                </a>
            </li>
            <li>
                <a href="/contact" class="py-4 rounded-xl hover:bg-[#d4af37]/10 hover:text-[#d4af37] transition-all duration-300">
                    <i class="fas fa-phone-alt ml-2 text-xl"></i> <span id="mnavContact">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</span>
                </a>
            </li>
        </ul>
    </div>

    <!-- Ø²Ø± Ø§Ù„Ù„ØºØ© Ø§Ù„Ù…Ø­Ø³Ù† -->
    <div class="dropdown dropdown-end ml-2 language-switcher">
        <label tabindex="0" class="btn btn-ghost rounded-xl hover:bg-[#d4af37]/10 hover:text-[#d4af37] transition-all duration-300">
            ğŸŒ <span id="current-lang">AR</span>
        </label>
        <ul tabindex="0" class="dropdown-content menu glass-card rounded-2xl w-28 shadow border border-[#d4af37]/30 p-2">
            <li><button onclick="changeLang('ar')" class="rounded-lg hover:bg-[#d4af37]/10 hover:text-[#d4af37] transition-all duration-300">ğŸ‡¸ğŸ‡¦ Ø¹Ø±Ø¨ÙŠ</button></li>
            <li><button onclick="changeLang('en')" class="rounded-lg hover:bg-[#d4af37]/10 hover:text-[#d4af37] transition-all duration-300">ğŸ‡¬ğŸ‡§ English</button></li>
        </ul>
    </div>
</header>

<!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ø§Ù„Ù…Ø­Ø³Ù† -->
<main class="max-w-7xl mx-auto p-4 md:p-6 min-h-[70vh]" x-data="productCatalog()" x-init="init()">

    <!-- Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…Ø­Ø³Ù† -->
    <div class="mb-8">
        <h1 id="catalogTitle" class="text-3xl md:text-4xl font-bold mb-6 text-center gold-text flex items-center justify-center gap-3">
            <i class="fas fa-box-open"></i>
            <span id="catalogTitleText">ÙƒØªØ§Ù„ÙˆØ¬ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</span>
            <span class="badge badge-lg product-count-badge" x-text="`${pagination.total} ${lang === 'ar' ? 'Ù…Ù†ØªØ¬' : 'products'}`"></span>
        </h1>

        <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ÙÙ„Ø§ØªØ± Ø§Ù„Ù…Ø­Ø³Ù† -->
        <div class="glass-card p-4 md:p-6 rounded-2xl mb-6 shadow-lg">
            <div class="grid md:grid-cols-3 gap-4">
                <!-- Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…Ø­Ø³Ù† -->
                <div class="form-control md:col-span-2">
                    <div class="flex rounded-2xl overflow-hidden shadow-lg">
                        <input id="searchInput" type="text"
                               x-model="searchQuery"
                               @input.debounce.500ms="searchProducts()"
                               :placeholder="lang === 'ar' ? 'Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬...' : 'Search for a product...'"
                               class="input flex-1 bg-base-200 text-gray-200 border-none focus:outline-none focus:ring-2 focus:ring-[#d4af37] rounded-none rounded-r-2xl">
                        <button @click="searchProducts()" class="btn search-btn rounded-none rounded-l-2xl px-6">
                            <span id="searchButtonText" x-text="lang === 'ar' ? 'Ø¨Ø­Ø«' : 'Search'"></span>
                        </button>
                    </div>
                </div>

                <!-- ÙÙ„ØªØ± Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ø­Ø³Ù† -->
                <select id="sortSelect" x-model="sortBy"
                        @change="sortProducts()"
                        class="select select-bordered bg-base-200 text-gray-200 rounded-2xl border-[#d4af37]/30 focus:border-[#d4af37] focus:ring-2 focus:ring-[#d4af37]/30">
                    <option id="sortDefault" value="">ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨</option>
                    <option id="sortPriceAsc" value="price-asc">Ø§Ù„Ø³Ø¹Ø±: Ù…Ù† Ø§Ù„Ø£Ù‚Ù„ Ù„Ù„Ø£Ø¹Ù„Ù‰</option>
                    <option id="sortPriceDesc" value="price-desc">Ø§Ù„Ø³Ø¹Ø±: Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰ Ù„Ù„Ø£Ù‚Ù„</option>
                    <option id="sortName" value="name">Ø§Ù„Ø§Ø³Ù…</option>
                </select>
            </div>

            <!-- Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù…Ø­Ø³Ù† -->
            <div class="flex flex-col sm:flex-row justify-between items-center mt-4 gap-3">
                <span class="text-gray-400 text-sm bg-base-200 px-3 py-1 rounded-full">
                    <span id="showingLabel" x-text="lang === 'ar' ? 'Ø¹Ø±Ø¶' : 'Showing'"></span>
                    <span x-text="products.length"></span>
                    <span id="ofLabel" x-text="lang === 'ar' ? 'Ù…Ù†' : 'of'"></span>
                    <span x-text="pagination.total"></span>
                </span>
                <select x-model="pagination.limit" @change="changeLimit()" class="select select-bordered select-sm bg-base-200 text-gray-200 rounded-xl border-[#d4af37]/30">
                    <option value="12">12 <span x-text="lang === 'ar' ? 'Ù…Ù†ØªØ¬' : 'products'"></span></option>
                    <option value="24">24 <span x-text="lang === 'ar' ? 'Ù…Ù†ØªØ¬' : 'products'"></span></option>
                    <option value="48">48 <span x-text="lang === 'ar' ? 'Ù…Ù†ØªØ¬' : 'products'"></span></option>
                    <option value="100">100 <span x-text="lang === 'ar' ? 'Ù…Ù†ØªØ¬' : 'products'"></span></option>
                </select>
            </div>
        </div>

        <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª Ø§Ù„Ø£ÙÙ‚ÙŠ Ø§Ù„Ù…Ø­Ø³Ù† -->
        <div class="mb-8">
            <h2 id="categoriesTitle" class="text-xl md:text-2xl font-bold mb-4 text-gray-100 flex items-center gap-2">
                <i class="fas fa-layer-group gold-text"></i>
                <span id="categoriesTitleText">Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</span>
            </h2>

            <div class="relative">
                <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ù…Ø­Ø³Ù†Ø© -->
                <button @click="scrollCategories('left')"
                        class="hidden md:block absolute left-0 top-1/2 -translate-y-1/2 z-10 btn btn-circle btn-sm shadow-lg"
                        style="background: rgba(212, 175, 55, 0.9); border: none;">
                    <i class="fas fa-chevron-left text-slate-900"></i>
                </button>
                <button @click="scrollCategories('right')"
                        class="hidden md:block absolute right-0 top-1/2 -translate-y-1/2 z-10 btn btn-circle btn-sm shadow-lg"
                        style="background: rgba(212, 175, 55, 0.9); border: none;">
                    <i class="fas fa-chevron-right text-slate-900"></i>
                </button>

                <!-- Ø­Ø§ÙˆÙŠØ© Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª Ø§Ù„Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ù…Ø­Ø³Ù†Ø© -->
                <div x-ref="categoriesScroll"
                     class="flex gap-3 overflow-x-auto pb-4 px-1 scroll-smooth hide-scrollbar"
                     style="scrollbar-width: none; -ms-overflow-style: none;">
                    <!-- ØªØµÙ†ÙŠÙ "Ø§Ù„ÙƒÙ„" Ø§Ù„Ù…Ø­Ø³Ù† -->
                    <div @click="selectedCategory = ''; filterProducts()"
                         :class="selectedCategory === '' ? 'active-category ring-2 ring-[#d4af37] shadow-lg' : 'hover:ring-2 hover:ring-[#d4af37]/50'"
                         class="flex-shrink-0 glass-card rounded-2xl overflow-hidden cursor-pointer transition-all duration-300 group category-card w-32 md:w-36">
                        <div class="h-20 md:h-24 bg-gradient-to-br from-[#d4af37] to-[#ffd700] flex items-center justify-center">
                            <i class="fas fa-th-large text-3xl md:text-4xl text-slate-900"></i>
                        </div>
                        <div class="p-3 text-center">
                            <h3 class="font-bold text-gray-100 text-sm" id="allLabel" x-text="lang === 'ar' ? 'Ø§Ù„ÙƒÙ„' : 'All'"></h3>
                            <p class="text-xs text-gray-400 mt-1">
                                <span x-text="allProductsCount"></span> <span id="productLabel" x-text="lang === 'ar' ? 'Ù…Ù†ØªØ¬' : 'products'"></span>
                            </p>
                        </div>
                    </div>

                    <!-- Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª Ø§Ù„ÙØ¹Ù„ÙŠØ© Ø§Ù„Ù…Ø­Ø³Ù†Ø© -->
                    <template x-for="cat in categories" :key="cat._id">
                        <div @click="selectedCategory = cat._id; filterProducts()"
                             :class="selectedCategory === cat._id ? 'active-category ring-2 ring-[#d4af37] shadow-lg' : 'hover:ring-2 hover:ring-[#d4af37]/50'"
                             class="flex-shrink-0 glass-card rounded-2xl overflow-hidden cursor-pointer transition-all duration-300 group category-card w-32 md:w-36">
                            <div class="category-image-container">
                                <img :src="cat.imageUrl || 'https://via.placeholder.com/150x100?text=' + (lang === 'ar' ? cat.nameAr : cat.nameEn || cat.nameAr)"
                                     :alt="lang === 'ar' ? cat.nameAr : cat.nameEn || cat.nameAr"
                                     class="category-image">
                            </div>
                            <div class="p-3 text-center">
                                <h3 class="font-bold text-gray-100 text-sm line-clamp-1" x-text="lang === 'ar' ? cat.nameAr : cat.nameEn || cat.nameAr"></h3>
                                <p class="text-xs text-gray-400 mt-1">
<!--                                    <span x-text="getCategoryProductCount(cat._id)"></span> <span id="productLabelCat" x-text="lang === 'ar' ? 'Ù…Ù†ØªØ¬' : 'products'"></span>-->
                                </p>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </div>
    </div>

    <!-- Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø³Ù†Ø© -->
    <div x-show="loading" class="flex flex-col justify-center items-center py-20 space-y-4">
        <div class="loading-spinner"></div>
        <p class="text-gray-400" x-text="lang === 'ar' ? 'Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª...' : 'Loading products...'"></p>
    </div>

    <!-- Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£ Ù…Ø­Ø³Ù†Ø© -->
    <div x-show="error" class="alert alert-error shadow-lg mb-6 rounded-2xl" x-transition>
        <i class="fas fa-exclamation-circle text-xl"></i>
        <span x-text="error"></span>
    </div>

    <!-- Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø­Ø³Ù† -->
    <div x-show="!loading && products.length > 0"
         class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 md:gap-6"
         x-transition>
        <template x-for="product in products" :key="product._id">
            <div class="glass-card rounded-2xl overflow-hidden shadow-xl hover:shadow-2xl transition-all duration-300 product-card group">
                <!-- ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ù…Ø­Ø³Ù†Ø© -->
                <div class="relative product-image-container">
                    <img :src="product.imageUrl || 'https://via.placeholder.com/300x200?text=No+Image'"
                         :alt="lang === 'ar' ? product.nameAr : product.nameEn || product.nameAr"
                         class="product-image">

                    <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø¹Ù„Ø§Ù… Ø§Ù„Ù…Ø¶Ø§Ù ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„ -->
                    <div class="flags-bar">
                        <img src="https://flagcdn.com/w20/vn.png" alt="ÙÙŠØªÙ†Ø§Ù…" class="flag-icon">
                        <img src="https://flagcdn.com/w20/cn.png" alt="Ø§Ù„ØµÙŠÙ†" class="flag-icon">
                        <img src="https://flagcdn.com/w20/it.png" alt="Ø¥ÙŠØ·Ø§Ù„ÙŠØ§" class="flag-icon">
                        <img src="https://flagcdn.com/w20/cz.png" alt="Ø§Ù„ØªØ´ÙŠÙƒ" class="flag-icon">
                        <img src="https://flagcdn.com/w20/pl.png" alt="Ø¨ÙˆÙ„Ù†Ø¯Ø§" class="flag-icon">
                    </div>

                    <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø³Ø¹Ø± ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰ -->
                    <div class="absolute top-2 right-2">
                        <span class="badge badge-lg shadow-lg" style="background: linear-gradient(135deg, #d4af37 0%, #ffd700 100%); color: #1a1a2e; font-weight: bold;">
                            <span x-text="product.price"></span> <span id="currencyLabel" x-text="lang === 'ar' ? 'Ø¬Ù†ÙŠÙ‡' : 'EGP'"></span>
                        </span>
                    </div>
                </div>

                <!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ù…Ø­Ø³Ù†Ø© -->
                <div class="p-4 md:p-5">
                    <h3 class="text-lg md:text-xl font-bold mb-2 text-gray-100 line-clamp-2" x-text="lang === 'ar' ? product.nameAr : product.nameEn || product.nameAr"></h3>
                    <p class="text-gray-400 text-sm mb-4 line-clamp-2" x-text="lang === 'ar' ? product.descriptionAr : product.descriptionEn || product.descriptionAr"></p>

                    <div class="flex items-center gap-2 mb-4 text-sm text-gray-300">
                        <i class="fas fa-layer-group gold-text"></i>
                        <span x-text="getCategoryName(product.categoryId)"></span>
                    </div>

                    <div class="flex gap-2">
                        <button @click="addToCart(product)"
                                class="btn btn-sm flex-1 text-slate-900 font-bold transition-all duration-300 hover:scale-105 shadow-lg"
                                style="background: linear-gradient(135deg, #d4af37 0%, #ffd700 100%); border: none;">
                            <i class="fas fa-cart-plus"></i>
                            <span class="ml-2" id="addToCartBtn" x-text="lang === 'ar' ? 'Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©' : 'Add to cart'"></span>
                        </button>
                        <button @click="showProductDetails(product)"
                                class="btn btn-sm btn-outline transition-all duration-300 hover:scale-105"
                                style="border-color: #d4af37; color: #d4af37;">
                            <i class="fas fa-eye"></i> <span class="ml-2" id="viewBtn" x-text="lang === 'ar' ? 'Ø¹Ø±Ø¶' : 'View'"></span>
                        </button>
                    </div>
                </div>
            </div>
        </template>
    </div>

    <!-- Ø±Ø³Ø§Ù„Ø© Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ù…Ù†ØªØ¬Ø§Øª Ù…Ø­Ø³Ù†Ø© -->
    <div x-show="!loading && products.length === 0"
         class="text-center py-16 md:py-20"
         x-transition>
        <div class="glass-card rounded-3xl p-8 md:p-12 max-w-md mx-auto shadow-lg">
            <i class="fas fa-box-open text-5xl md:text-6xl gold-text mb-4"></i>
            <h3 id="noProductsTitle" class="text-xl md:text-2xl font-bold mb-2 text-gray-100" x-text="lang === 'ar' ? 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª' : 'No products found'"></h3>
            <p id="noProductsDesc" class="text-gray-400" x-text="lang === 'ar' ? 'Ø¬Ø±Ø¨ Ø§Ù„Ø¨Ø­Ø« Ø¨ÙƒÙ„Ù…Ø§Øª Ù…Ø®ØªÙ„ÙØ© Ø£Ùˆ ØªØµÙØ­ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª' : 'Try different keywords or browse all categories'"></p>
        </div>
    </div>

    <!-- Pagination Controls Ø§Ù„Ù…Ø­Ø³Ù†Ø© -->
    <div x-show="!loading && pagination.totalPages > 1" class="flex flex-col sm:flex-row justify-center items-center gap-4 mt-8">
        <div class="flex gap-2 flex-wrap justify-center">
            <button @click="goToPage(1)" :disabled="pagination.page === 1"
                    class="btn btn-sm pagination-btn rounded-xl"
                    :class="pagination.page === 1 ? 'btn-disabled' : ''"
                    style="background: linear-gradient(135deg, #d4af37 0%, #ffd700 100%); color: #1a1a2e; border: none;">
                Â«
            </button>
            <button @click="goToPage(pagination.page - 1)" :disabled="pagination.page === 1"
                    class="btn btn-sm pagination-btn rounded-xl"
                    :class="pagination.page === 1 ? 'btn-disabled' : ''"
                    style="background: linear-gradient(135deg, #d4af37 0%, #ffd700 100%); color: #1a1a2e; border: none;">
                â€¹
            </button>

            <template x-for="pageNum in visiblePages" :key="pageNum">
                <button
                        @click="goToPage(pageNum)"
                        :class="pageNum === pagination.page ? 'ring-2 ring-[#d4af37] shadow-lg' : 'hover:ring-2 hover:ring-[#d4af37]/50'"
                        :style="pageNum === pagination.page ? 'background: #d4af37; color: #1a1a2e;' : 'background: rgba(212, 175, 55, 0.2); color: #d4af37;'"
                        class="btn btn-sm pagination-btn rounded-xl"
                        x-text="pageNum"
                ></button>
            </template>

            <button @click="goToPage(pagination.page + 1)" :disabled="pagination.page === pagination.totalPages"
                    class="btn btn-sm pagination-btn rounded-xl"
                    :class="pagination.page === pagination.totalPages ? 'btn-disabled' : ''"
                    style="background: linear-gradient(135deg, #d4af37 0%, #ffd700 100%); color: #1a1a2e; border: none;">
                â€º
            </button>
            <button @click="goToPage(pagination.totalPages)" :disabled="pagination.page === pagination.totalPages"
                    class="btn btn-sm pagination-btn rounded-xl"
                    :class="pagination.page === pagination.totalPages ? 'btn-disabled' : ''"
                    style="background: linear-gradient(135deg, #d4af37 0%, #ffd700 100%); color: #1a1a2e; border: none;">
                Â»
            </button>
        </div>

        <span class="text-sm text-gray-400 bg-base-200 px-3 py-1 rounded-full">
            <span id="pageLabel" x-text="lang === 'ar' ? 'ØµÙØ­Ø©' : 'Page'"></span> <span x-text="pagination.page"></span>
            <span id="ofPagesLabel" x-text="lang === 'ar' ? 'Ù…Ù†' : 'of'"></span> <span x-text="pagination.totalPages"></span>
        </span>
    </div>

    <!-- Modal ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ù…Ø­Ø³Ù† -->
    <div x-show="showModal"
         x-transition
         @click="showModal = false"
         class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50">
        <div @click.stop
             x-transition
             class="glass-card rounded-3xl max-w-2xl w-full p-6 md:p-8 max-h-[90vh] overflow-y-auto shadow-2xl border border-[#d4af37]/30">
            <template x-if="selectedProduct">
                <div>
                    <!-- Ø²Ø± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ -->
                    <button @click="showModal = false" class="btn btn-circle btn-sm absolute top-4 left-4 bg-base-200 border-none text-gray-400 hover:text-gray-200 hover:bg-base-300">
                        <i class="fas fa-times"></i>
                    </button>

                    <div class="product-image-container rounded-2xl mb-6 relative">
                        <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø¹Ù„Ø§Ù… ÙÙŠ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ - ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„ -->
                        <div class="flags-bar">
                            <img src="https://flagcdn.com/w20/vn.png" alt="ÙÙŠØªÙ†Ø§Ù…" class="flag-icon">
                            <img src="https://flagcdn.com/w20/cn.png" alt="Ø§Ù„ØµÙŠÙ†" class="flag-icon">
                            <img src="https://flagcdn.com/w20/it.png" alt="Ø¥ÙŠØ·Ø§Ù„ÙŠØ§" class="flag-icon">
                            <img src="https://flagcdn.com/w20/cz.png" alt="Ø§Ù„ØªØ´ÙŠÙƒ" class="flag-icon">
                            <img src="https://flagcdn.com/w20/pl.png" alt="Ø¨ÙˆÙ„Ù†Ø¯Ø§" class="flag-icon">
                        </div>

                        <img :src="selectedProduct.imageUrl || 'https://via.placeholder.com/600x400'"
                             :alt="lang === 'ar' ? selectedProduct.nameAr : selectedProduct.nameEn || selectedProduct.nameAr"
                             class="product-image">
                    </div>
                    <h2 class="text-2xl md:text-3xl font-bold mb-4 text-gray-100 pr-8" x-text="lang === 'ar' ? selectedProduct.nameAr : selectedProduct.nameEn || selectedProduct.nameAr"></h2>
                    <p class="text-gray-300 mb-4 leading-relaxed" x-text="lang === 'ar' ? selectedProduct.descriptionAr : selectedProduct.descriptionEn || selectedProduct.descriptionAr"></p>
                    <div class="flex flex-col sm:flex-row items-start sm:items-center gap-4 mb-6">
                        <span class="text-2xl md:text-3xl font-bold gold-text">
                            <span x-text="selectedProduct.price"></span> <span id="currencyLabelModal" x-text="lang === 'ar' ? 'Ø¬Ù†ÙŠÙ‡' : 'EGP'"></span>
                        </span>
                        <span class="badge badge-lg shadow-lg" style="background: rgba(212, 175, 55, 0.2); color: #d4af37;">
                            <i class="fas fa-layer-group ml-1"></i>
                            <span x-text="getCategoryName(selectedProduct.categoryId)"></span>
                        </span>
                    </div>
                    <div class="flex flex-col sm:flex-row gap-3">
                        <button @click="addToCart(selectedProduct); showModal = false"
                                class="btn flex-1 text-slate-900 font-bold shadow-lg hover:scale-105 transition-all duration-300"
                                style="background: linear-gradient(135deg, #d4af37 0%, #ffd700 100%); border: none;">
                            <i class="fas fa-cart-plus ml-2"></i>
                            <span id="addToCartModalBtn" x-text="lang === 'ar' ? 'Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©' : 'Add to cart'"></span>
                        </button>
                        <button @click="showModal = false"
                                class="btn btn-outline hover:scale-105 transition-all duration-300"
                                style="border-color: #d4af37; color: #d4af37;">
                            <span id="closeBtn" x-text="lang === 'ar' ? 'Ø¥ØºÙ„Ø§Ù‚' : 'Close'"></span>
                        </button>
                    </div>
                </div>
            </template>
        </div>
    </div>

    <!-- Toast Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø© Ø§Ù„Ù…Ø­Ø³Ù† -->
    <div x-show="showToast"
         x-transition
         class="toast toast-top toast-center z-50">
        <div class="alert shadow-2xl rounded-2xl border-none toast-success">
            <i class="fas fa-check-circle text-2xl"></i>
            <span class="font-bold" x-text="toastMessage"></span>
        </div>
    </div>
</main>

<!-- Ø§Ù„ÙÙˆØªØ± Ø§Ù„Ù…Ø­Ø³Ù† -->
<footer class="footer footer-center p-8 md:p-12 glass-card text-gray-300 relative overflow-hidden mt-12 border-t border-[#d4af37]/20" x-data="headerManager()">
    <div class="absolute inset-0 bg-gradient-to-b from-transparent to-[#d4af37]/5"></div>
    <div class="relative mb-6 text-center">
        <div class="flex items-center justify-center gap-3 mb-2">
            <img src="/images/logo.webp" alt="Ø´Ø¹Ø§Ø±" class="rounded-lg" style="width: 50px;">
            <span id="footerBrand" class="text-2xl md:text-3xl font-bold gold-text">Ø¬Ø§Ù„ Ù„Ù„ØªØ¬Ø§Ø±Ø©</span>
        </div>
        <p id="footerDesc" class="text-gray-400 max-w-md mx-auto" x-text="lang === 'ar' ? 'Ø´Ø±ÙŠÙƒÙƒ Ø§Ù„Ù…ÙˆØ«ÙˆÙ‚ ÙÙŠ ØªÙˆØ±ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª ÙˆØ§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ© Ø¨Ø£Ø¹Ù„Ù‰ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¬ÙˆØ¯Ø©' : 'Your trusted partner in supplying top-quality industrial products.'"></p>
    </div>
    <nav class="grid grid-flow-col gap-4 md:gap-6 text-base relative">
        <a href="/productCatalog" class="link link-hover hover:text-[#d4af37] transition-colors duration-300 rounded-lg px-3 py-1 hover:bg-[#d4af37]/10"><i class="fas fa-box-open ml-1"></i> <span id="fnavProducts" x-text="lang === 'ar' ? 'Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª' : 'Products'"></span></a>
        <a href="/cart" class="link link-hover hover:text-[#d4af37] transition-colors duration-300 rounded-lg px-3 py-1 hover:bg-[#d4af37]/10 relative">
            <i class="fas fa-shopping-cart ml-1"></i> <span id="fnavCart" x-text="lang === 'ar' ? 'Ø§Ù„Ø³Ù„Ø©' : 'Cart'"></span>
            <span x-show="cartCount > 0" x-cloak class="cart-badge" x-text="cartCount"></span>
        </a>
        <a href="/contact" class="link link-hover hover:text-[#d4af37] transition-colors duration-300 rounded-lg px-3 py-1 hover:bg-[#d4af37]/10"><i class="fas fa-phone-alt ml-1"></i> <span id="fnavContact" x-text="lang === 'ar' ? 'ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§' : 'Contact'"></span></a>
    </nav>
    <div class="flex justify-center gap-4 md:gap-6 text-xl md:text-2xl mt-6 mb-4 relative">
        <a href="https://www.facebook.com/profile.php?id=61581092905595" class="w-12 h-12 rounded-full bg-blue-600 flex items-center justify-center hover:scale-110 transition-transform">
            <i class="fab fa-facebook-f text-white"></i>
        </a>
        <a href="https://www.tiktok.com/@galimport1?is_from_webapp=1&sender_device=pc" class="w-12 h-12 rounded-full bg-pink-500 flex items-center justify-center hover:scale-110 transition-transform">
            <i class="fab fa-tiktok text-white"></i>
        </a>
        <a href="https://wa.me/201002491168" class="w-12 h-12 rounded-full bg-green-500 flex items-center justify-center hover:scale-110 transition-transform">
            <i class="fab fa-whatsapp text-white"></i>
        </a>
        <a href="https://www.linkedin.com/in/gal-import-ba74bb38b/" class="w-12 h-12 rounded-full bg-blue-700 flex items-center justify-center hover:scale-110 transition-transform">
            <i class="fab fa-linkedin-in text-white"></i>
        </a>
    </div>
    <p id="copyrightText" class="text-gray-400 mt-4 text-center relative" x-text="lang === 'ar' ? 'Â© 2025 Ø¬Ø§Ù„ Ù„Ù„ØªØ¬Ø§Ø±Ø© ÙˆØ§Ù„ØªÙˆØ±ÙŠØ¯Ø§Øª â€” Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©' : 'Â© 2025 Gal Trading & Supplies â€” All rights reserved'"></p>
</footer>

<script>
    // Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ù…Ù† Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª Ø§Ù„Ø£ØµÙ„ÙŠ ÙŠØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡Ùˆ Ù…Ø¹ Ø¥Ø¶Ø§ÙØ© Ø¯Ø¹Ù… Ø¥Ø¶Ø§ÙÙŠ Ù„Ù„ØºØ©
    const langs = {
        ar: {
            brandName: "Ø¬Ø§Ù„ Ù„ØªÙˆØ±ÙŠØ¯Ø§Øª Ø§Ù„Ù…ØµØ§Ù†Ø¹",
            pageTitle: "ÙƒØªØ§Ù„ÙˆØ¬ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª - Ø¬Ø§Ù„ Ù„Ù„ØªØ¬Ø§Ø±Ø©",
            catalogTitle: "ÙƒØªØ§Ù„ÙˆØ¬ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª",
            searchPlaceholder: "Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬...",
            searchButton: "Ø¨Ø­Ø«",
            sortDefault: "ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨",
            sortPriceAsc: "Ø§Ù„Ø³Ø¹Ø±: Ù…Ù† Ø§Ù„Ø£Ù‚Ù„ Ù„Ù„Ø£Ø¹Ù„Ù‰",
            sortPriceDesc: "Ø§Ù„Ø³Ø¹Ø±: Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰ Ù„Ù„Ø£Ù‚Ù„",
            sortName: "Ø§Ù„Ø§Ø³Ù…",
            categoriesTitle: "Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª",
            allLabel: "Ø§Ù„ÙƒÙ„",
            productWord: "Ù…Ù†ØªØ¬",
            addToCartBtn: "Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©",
            viewBtn: "Ø¹Ø±Ø¶",
            noProductsTitle: "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª",
            noProductsDesc: "Ø¬Ø±Ø¨ Ø§Ù„Ø¨Ø­Ø« Ø¨ÙƒÙ„Ù…Ø§Øª Ù…Ø®ØªÙ„ÙØ© Ø£Ùˆ ØªØµÙØ­ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª",
            currency: "Ø¬Ù†ÙŠÙ‡",
            addToCartToast: 'ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© "{name}" Ù„Ù„Ø³Ù„Ø©',
            showingLabel: "Ø¹Ø±Ø¶",
            ofLabel: "Ù…Ù†",
            pageLabel: "ØµÙØ­Ø©",
            ofPagesLabel: "Ù…Ù†",
            navProducts: "Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª",
            navCart: "Ø§Ù„Ø³Ù„Ø©",
            navContact: "ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§",
            footerBrand: "Ø¬Ø§Ù„ Ù„Ù„ØªØ¬Ø§Ø±Ø©",
            footerDesc: "Ø´Ø±ÙŠÙƒÙƒ Ø§Ù„Ù…ÙˆØ«ÙˆÙ‚ ÙÙŠ ØªÙˆØ±ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª ÙˆØ§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ© Ø¨Ø£Ø¹Ù„Ù‰ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¬ÙˆØ¯Ø©",
            copyright: "Â© 2025 Ø¬Ø§Ù„ Ù„Ù„ØªØ¬Ø§Ø±Ø© ÙˆØ§Ù„ØªÙˆØ±ÙŠØ¯Ø§Øª â€” Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©",
            loadingText: "Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª..."
        },
        en: {
            brandName: "Gal Industrial Supplies",
            pageTitle: "Product Catalog - Gal Trading",
            catalogTitle: "Product Catalog",
            searchPlaceholder: "Search for a product...",
            searchButton: "Search",
            sortDefault: "Sort by",
            sortPriceAsc: "Price: low to high",
            sortPriceDesc: "Price: high to low",
            sortName: "Name",
            categoriesTitle: "Categories",
            allLabel: "All",
            productWord: "product",
            addToCartBtn: "Add to cart",
            viewBtn: "View",
            noProductsTitle: "No products found",
            noProductsDesc: "Try different keywords or browse categories",
            currency: "EGP",
            addToCartToast: 'Added "{name}" to cart',
            showingLabel: "Showing",
            ofLabel: "of",
            pageLabel: "Page",
            ofPagesLabel: "of",
            navProducts: "Products",
            navCart: "Cart",
            navContact: "Contact",
            footerBrand: "Gal Trading",
            footerDesc: "Your trusted partner in supplying top-quality industrial products.",
            copyright: "Â© 2025 Gal Trading & Supplies â€” All rights reserved",
            loadingText: "Loading products..."
        }
    };

    function applyTranslations(lang) {
        const t = langs[lang] || langs.ar;
        const map = {
            brandName: t.brandName,
            pageTitle: t.pageTitle,
            catalogTitleText: t.catalogTitle,
            sortDefault: t.sortDefault,
            sortPriceAsc: t.sortPriceAsc,
            sortPriceDesc: t.sortPriceDesc,
            sortName: t.sortName,
            categoriesTitleText: t.categoriesTitle,
            allLabel: t.allLabel,
            productLabel: t.productWord,
            productLabelCat: t.productWord,
            addToCartBtn: t.addToCartBtn,
            addToCartModalBtn: t.addToCartBtn,
            viewBtn: t.viewBtn,
            noProductsTitle: t.noProductsTitle,
            noProductsDesc: t.noProductsDesc,
            currencyLabel: t.currency,
            currencyLabelModal: t.currency,
            showingLabel: t.showingLabel,
            ofLabel: t.ofLabel,
            pageLabel: t.pageLabel,
            ofPagesLabel: t.ofPagesLabel,
            navProducts: t.navProducts,
            navCart: t.navCart,
            navContact: t.navContact,
            mnavProducts: t.navProducts,
            mnavCart: t.navCart,
            mnavContact: t.navContact,
            fnavProducts: t.navProducts,
            fnavCart: t.navCart,
            fnavContact: t.navContact,
            footerBrand: t.footerBrand,
            footerDesc: t.footerDesc,
            copyrightText: t.copyright,
            searchButtonText: t.searchButton
        };

        for (const id in map) {
            const el = document.getElementById(id);
            if (!el || map[id] === null) continue;
            el.innerText = map[id];
        }

        const searchEl = document.getElementById('searchInput');
        if (searchEl) searchEl.placeholder = t.searchPlaceholder;

        const curr = document.getElementById('current-lang');
        if (curr) curr.innerText = lang.toUpperCase();

        document.documentElement.dir = (lang === 'ar') ? 'rtl' : 'ltr';
        document.documentElement.lang = (lang === 'ar') ? 'ar' : 'en';
        document.title = t.pageTitle;

        localStorage.setItem('lang', lang);
    }

    function loadSavedLang() {
        const saved = localStorage.getItem('lang') || 'ar';
        applyTranslations(saved);
    }

    function changeLang(lang) {
        applyTranslations(lang);
        location.reload();
    }

    document.addEventListener('DOMContentLoaded', loadSavedLang);

   function productCatalog() {
    return {
        products: [],
        categories: [],
        loading: true,
        error: '',
        searchQuery: '',
        selectedCategory: '',
        sortBy: '',
        showModal: false,
        selectedProduct: null,
        showToast: false,
        toastMessage: '',
        allProductsCount: 0,
        lang: localStorage.getItem('lang') || 'ar',
        pagination: {
            page: 1,
            limit: 24,
            total: 0,
            totalPages: 0
        },

        get visiblePages() {
            const current = this.pagination.page;
            const total = this.pagination.totalPages;
            const pages = [];

            let start = Math.max(1, current - 2);
            let end = Math.min(total, current + 2);

            if (end - start < 4) {
                if (start === 1) {
                    end = Math.min(total, start + 4);
                } else if (end === total) {
                    start = Math.max(1, end - 4);
                }
            }

            for (let i = start; i <= end; i++) {
                pages.push(i);
            }

            return pages;
        },

        async init() {
            const lang = localStorage.getItem('lang') || 'ar';
            this.lang = lang;
            if (typeof applyTranslations === 'function') applyTranslations(lang);

            await this.loadCategories();
            await this.loadProducts();
        },

        async loadProducts() {
            try {
                this.loading = true;
                this.error = '';

                // ØªÙ†Ø¸ÙŠÙ query Ø§Ù„Ø¨Ø­Ø« Ù„Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø±Ù…ÙˆØ² Ø§Ù„Ø®Ø§ØµØ©
                const cleanSearchQuery = this.cleanSearchText(this.searchQuery);

                const params = new URLSearchParams({
                    page: this.pagination.page,
                    limit: this.pagination.limit,
                    search: cleanSearchQuery
                });

                if (this.selectedCategory) {
                    params.append('category', this.selectedCategory);
                }

                if (this.sortBy) {
                    params.append('sort', this.sortBy);
                }

                console.log('Search params:', params.toString()); // Ù„Ù„ØªØµØ­ÙŠØ­

                const response = await fetch(`/api/products?${params}`);
                if (!response.ok) throw new Error('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª');

                const data = await response.json();

                if (data.data) {
                    this.products = data.data;
                    this.pagination.total = data.total;
                    this.pagination.totalPages = data.totalPages;
                    this.pagination.page = data.page;
                } else {
                    this.products = data;
                    this.pagination.total = data.length;
                    this.pagination.totalPages = 1;
                }

                if (!this.allProductsCount) {
                    this.allProductsCount = this.pagination.total;
                }
            } catch (err) {
                this.error = (this.lang === 'en') ? 'Failed to load products' : 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª';
                console.error('Error loading products:', err);
            } finally {
                this.loading = false;
            }
        },

        // Ø¯Ø§Ù„Ø© Ù„ØªÙ†Ø¸ÙŠÙ Ù†Øµ Ø§Ù„Ø¨Ø­Ø«
        cleanSearchText(text) {
            if (!text) return '';

            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø±Ù…ÙˆØ² Ø§Ù„Ø®Ø§ØµØ© ÙˆØ§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙˆØ§Ù„Ø­Ø±ÙˆÙ ÙÙ‚Ø·
            return text
                .replace(/[^\w\u0600-\u06FF\s\d]/g, ' ') // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø±Ù…ÙˆØ² Ø§Ù„Ø®Ø§ØµØ©
                .replace(/\s+/g, ' ') // Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ù…Ø³Ø§ÙØ§Øª Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø© Ø¨Ù…Ø³Ø§ÙØ© ÙˆØ§Ø­Ø¯Ø©
                .trim();
        },

        async loadCategories() {
            try {
                const response = await fetch('/api/categories');
                if (!response.ok) throw new Error('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª');

                const data = await response.json();
                this.categories = data;
            } catch (err) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª:', err);
            }
        },

        async searchProducts() {
            this.pagination.page = 1;
            await this.loadProducts();
        },

        async filterProducts() {
            this.pagination.page = 1;
            await this.loadProducts();
        },

        async sortProducts() {
            await this.loadProducts();
        },

        async goToPage(page) {
            if (page < 1 || page > this.pagination.totalPages) return;
            this.pagination.page = page;
            await this.loadProducts();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        },

        async changeLimit() {
            this.pagination.page = 1;
            await this.loadProducts();
        },

        getCategoryName(categoryId) {
            const category = this.categories.find(c => c._id === categoryId);
            return category ? (this.lang === 'ar' ? category.nameAr : category.nameEn || category.nameAr) : (this.lang === 'en' ? 'Unspecified' : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯');
        },

        getCategoryProductCount(categoryId) {
            return this.products.filter(p => p.categoryId === categoryId).length;
        },

        scrollCategories(direction) {
            const container = this.$refs.categoriesScroll;
            const scrollAmount = 300;

            if (!container) return;
            if (direction === 'left') {
                container.scrollLeft -= scrollAmount;
            } else {
                container.scrollLeft += scrollAmount;
            }
        },

        showProductDetails(product) {
            this.selectedProduct = product;
            this.showModal = true;
        },

        addToCart(product) {
            let cart = JSON.parse(localStorage.getItem('cart') || '[]');
            const existingItem = cart.find(item => item._id === product._id);
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({...product, quantity: 1});
            }
            localStorage.setItem('cart', JSON.stringify(cart));

            const cartEvent = new Event('cartUpdated');
            window.dispatchEvent(cartEvent);

            const lang = this.lang;
            const name = lang === 'ar' ? product.nameAr : product.nameEn || product.nameAr;
            const template = langs[lang]?.addToCartToast || 'ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© "{name}" Ù„Ù„Ø³Ù„Ø©';
            this.toastMessage = template.replace('{name}', name);
            this.showToast = true;
            setTimeout(() => { this.showToast = false; }, 3000);
        }
    };
}

    function headerManager() {
        return {
            cartCount: 0,
            init() {
                this.loadCartCount();
                window.addEventListener('storage', () => this.loadCartCount());
                window.addEventListener('cartUpdated', () => this.loadCartCount());
            },
            loadCartCount() {
                const cart = localStorage.getItem('cart');
                const items = cart ? JSON.parse(cart) : [];
                this.cartCount = items.reduce((sum, item) => sum + item.quantity, 0);
            }
        };
    }
</script>

</body>
</html>