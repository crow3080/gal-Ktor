<!DOCTYPE html>
<html lang="ar" dir="rtl" data-theme="luxury">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>كتالوج المنتجات - جال للتجارة</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.x/dist/full.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <style>
        body {
            font-family: 'Cairo', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
        }
        .glass-card {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.8) 0%, rgba(51, 65, 85, 0.6) 100%);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(212, 175, 55, 0.2);
            transition: all 0.4s;
        }
        .glass-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(212, 175, 55, 0.3);
            border-color: rgba(212, 175, 55, 0.5);
        }
        .product-image {
            height: 200px;
            object-fit: cover;
            background: rgba(255, 255, 255, 0.05);
        }
        .gold-text {
            color: #d4af37;
        }
        .loading-spinner {
            border: 3px solid rgba(212, 175, 55, 0.3);
            border-top: 3px solid #d4af37;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
    </style>
</head>
<body class="bg-base-100">

<!-- الهيدر -->
<header class="navbar bg-base-100 shadow-lg sticky top-0 z-50 px-4">
    <div class="flex-1">
        <a href="/" class="text-2xl font-bold flex items-center gap-2">
            <i class="fas fa-industry text-3xl" style="color: #d4af37;"></i>
            <span>جال للتجارة و توريدات المصانع</span>
        </a>
    </div>

    <nav class="hidden md:flex gap-3">
        <a href="/productCatalog" class="btn btn-ghost btn-sm"><i class="fas fa-box-open ml-1"></i> المنتجات</a>
        <a href="/cart" class="btn btn-ghost btn-sm"><i class="fas fa-shopping-cart ml-1"></i> السلة</a>
        <a href="/contact" class="btn btn-ghost btn-sm"><i class="fas fa-phone-alt ml-1"></i> تواصل معنا</a>
        <a href="/clientLogin" class="btn btn-primary btn-sm">تسجيل الدخول</a>
    </nav>

    <div class="dropdown dropdown-end md:hidden relative">
        <button tabindex="0" class="btn btn-ghost btn-lg">
            <i class="fas fa-bars text-2xl"></i>
        </button>
        <ul tabindex="0" class="menu menu-lg dropdown-content mt-3 shadow-2xl bg-base-100 rounded-box w-64 z-[100] p-3 text-lg font-semibold border-2 border-[#d4af37]">
            <li><a href="/productCatalog" class="py-4"><i class="fas fa-box-open ml-2 text-xl"></i> المنتجات</a></li>
            <li><a href="/cart" class="py-4"><i class="fas fa-shopping-cart ml-2 text-xl"></i> السلة</a></li>
            <li><a href="/contact" class="py-4"><i class="fas fa-phone-alt ml-2 text-xl"></i> تواصل معنا</a></li>
            <li><a href="/clientLogin" class="py-4 text-[#d4af37]"><i class="fas fa-sign-in-alt ml-2 text-xl"></i> تسجيل الدخول</a></li>
        </ul>
    </div>
</header>

<!-- المحتوى الرئيسي -->
<main class="max-w-7xl mx-auto p-6 min-h-[70vh]" x-data="productCatalog()" x-init="init()">

    <!-- العنوان والبحث -->
    <div class="mb-8">
        <h1 class="text-4xl font-bold mb-6 text-center" style="color: #d4af37;">
            <i class="fas fa-box-open ml-2"></i> كتالوج المنتجات
        </h1>

        <!-- شريط البحث والفلاتر -->
        <div class="glass-card p-6 rounded-2xl mb-6">
            <div class="grid md:grid-cols-2 gap-4">
                <!-- البحث -->
                <div class="form-control">
                    <div class="input-group">
                        <input type="text"
                               x-model="searchQuery"
                               @input="filterProducts()"
                               placeholder="ابحث عن منتج..."
                               class="input input-bordered w-full bg-base-200 text-gray-200">
                        <button class="btn btn-square" style="background: #d4af37;">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>

                <!-- فلتر السعر -->
                <select x-model="sortBy"
                        @change="sortProducts()"
                        class="select select-bordered bg-base-200 text-gray-200">
                    <option value="">ترتيب حسب</option>
                    <option value="price-asc">السعر: من الأقل للأعلى</option>
                    <option value="price-desc">السعر: من الأعلى للأقل</option>
                    <option value="name">الاسم</option>
                </select>
            </div>
        </div>

        <!-- شريط التصنيفات الأفقي -->
        <div class="mb-8">
            <h2 class="text-2xl font-bold mb-4 text-gray-100 flex items-center gap-2">
                <i class="fas fa-layer-group gold-text"></i>
                التصنيفات
            </h2>

            <div class="relative">
                <!-- أزرار التمرير -->
                <button @click="scrollCategories('right')"
                        class="hidden md:block absolute right-0 top-1/2 -translate-y-1/2 z-10 btn btn-circle btn-sm"
                        style="background: rgba(212, 175, 55, 0.9); border: none;">
                    <i class="fas fa-chevron-right text-slate-900"></i>
                </button>
                <button @click="scrollCategories('left')"
                        class="hidden md:block absolute left-0 top-1/2 -translate-y-1/2 z-10 btn btn-circle btn-sm"
                        style="background: rgba(212, 175, 55, 0.9); border: none;">
                    <i class="fas fa-chevron-left text-slate-900"></i>
                </button>

                <!-- حاوية التصنيفات القابلة للتمرير -->
                <div x-ref="categoriesScroll"
                     class="flex gap-4 overflow-x-auto pb-4 px-2 scroll-smooth hide-scrollbar"
                     style="scrollbar-width: none; -ms-overflow-style: none;">

                    <!-- تصنيف "الكل" -->
                    <div @click="selectedCategory = ''; filterProducts()"
                         :class="selectedCategory === '' ? 'ring-4 ring-[#d4af37]' : ''"
                         class="flex-shrink-0 w-36 glass-card rounded-2xl overflow-hidden cursor-pointer hover:scale-105 transition-all duration-300 group">
                        <div class="h-24 bg-gradient-to-br from-[#d4af37] to-[#ffd700] flex items-center justify-center">
                            <i class="fas fa-th-large text-4xl text-slate-900"></i>
                        </div>
                        <div class="p-3 text-center">
                            <h3 class="font-bold text-gray-100 text-sm">الكل</h3>
                            <p class="text-xs text-gray-400 mt-1">
                                <span x-text="products.length"></span> منتج
                            </p>
                        </div>
                    </div>

                    <!-- التصنيفات الفعلية -->
                    <template x-for="cat in categories" :key="cat._id">
                        <div @click="selectedCategory = cat._id; filterProducts()"
                             :class="selectedCategory === cat._id ? 'ring-4 ring-[#d4af37]' : ''"
                             class="flex-shrink-0 w-36 glass-card rounded-2xl overflow-hidden cursor-pointer hover:scale-105 transition-all duration-300 group">
                            <div class="h-24 overflow-hidden bg-base-300">
                                <img :src="cat.imageUrl || 'https://via.placeholder.com/150x100?text=' + cat.name"
                                     :alt="cat.name"
                                     class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-300">
                            </div>
                            <div class="p-3 text-center">
                                <h3 class="font-bold text-gray-100 text-sm line-clamp-1" x-text="cat.name"></h3>
                                <p class="text-xs text-gray-400 mt-1">
                                    <span x-text="getCategoryProductCount(cat._id)"></span> منتج
                                </p>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </div>
    </div>

    <!-- حالة التحميل -->
    <div x-show="loading" class="flex justify-center items-center py-20">
        <div class="loading-spinner"></div>
    </div>

    <!-- رسالة خطأ -->
    <div x-show="error" class="alert alert-error shadow-lg mb-6" x-transition>
        <i class="fas fa-exclamation-circle"></i>
        <span x-text="error"></span>
    </div>

    <!-- عرض المنتجات -->
    <div x-show="!loading && filteredProducts.length > 0"
         class="grid sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"
         x-transition>
        <template x-for="product in filteredProducts" :key="product._id">
            <div class="glass-card rounded-2xl overflow-hidden shadow-xl">
                <!-- صورة المنتج -->
                <div class="relative">
                    <img :src="product.imageUrl || 'https://via.placeholder.com/300x200?text=No+Image'"
                         :alt="product.name"
                         class="w-full product-image">
                    <div class="absolute top-2 right-2">
                        <span class="badge badge-lg" style="background: #d4af37; color: #1a1a2e; font-weight: bold;">
                            <span x-text="product.price"></span> جنيه
                        </span>
                    </div>
                </div>

                <!-- تفاصيل المنتج -->
                <div class="p-5">
                    <h3 class="text-xl font-bold mb-2 text-gray-100" x-text="product.name"></h3>
                    <p class="text-gray-400 text-sm mb-4 line-clamp-2" x-text="product.description"></p>

                    <div class="flex items-center gap-2 mb-4 text-sm text-gray-300">
                        <i class="fas fa-layer-group gold-text"></i>
                        <span x-text="getCategoryName(product.categoryId)"></span>
                    </div>

                    <div class="flex gap-2">
                        <button @click="addToCart(product)"
                                class="btn btn-sm flex-1 text-slate-900 font-bold hover:scale-105 transition-transform"
                                style="background: linear-gradient(135deg, #d4af37 0%, #ffd700 100%); border: none;">
                            <i class="fas fa-cart-plus"></i>
                            أضف للسلة
                        </button>
                        <button @click="showProductDetails(product)"
                                class="btn btn-sm btn-outline"
                                style="border-color: #d4af37; color: #d4af37;">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
            </div>
        </template>
    </div>

    <!-- رسالة عدم وجود منتجات -->
    <div x-show="!loading && filteredProducts.length === 0"
         class="text-center py-20"
         x-transition>
        <div class="glass-card rounded-3xl p-12 max-w-md mx-auto">
            <i class="fas fa-box-open text-6xl gold-text mb-4"></i>
            <h3 class="text-2xl font-bold mb-2 text-gray-100">لا توجد منتجات</h3>
            <p class="text-gray-400">جرب البحث بكلمات مختلفة أو تصفح جميع التصنيفات</p>
        </div>
    </div>

    <!-- Modal تفاصيل المنتج -->
    <div x-show="showModal"
         x-transition
         @click="showModal = false"
         class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50">
        <div @click.stop
             x-transition
             class="glass-card rounded-3xl max-w-2xl w-full p-8 max-h-[90vh] overflow-y-auto">
            <template x-if="selectedProduct">
                <div>
                    <img :src="selectedProduct.imageUrl || 'https://via.placeholder.com/600x400'"
                         :alt="selectedProduct.name"
                         class="w-full h-64 object-cover rounded-2xl mb-6">

                    <h2 class="text-3xl font-bold mb-4 text-gray-100" x-text="selectedProduct.name"></h2>
                    <p class="text-gray-300 mb-4" x-text="selectedProduct.description"></p>

                    <div class="flex items-center gap-4 mb-6">
                        <span class="text-3xl font-bold gold-text">
                            <span x-text="selectedProduct.price"></span> جنيه
                        </span>
                        <span class="badge badge-lg" style="background: rgba(212, 175, 55, 0.2); color: #d4af37;">
                            <i class="fas fa-layer-group ml-1"></i>
                            <span x-text="getCategoryName(selectedProduct.categoryId)"></span>
                        </span>
                    </div>

                    <div class="flex gap-3">
                        <button @click="addToCart(selectedProduct); showModal = false"
                                class="btn flex-1 text-slate-900 font-bold"
                                style="background: linear-gradient(135deg, #d4af37 0%, #ffd700 100%); border: none;">
                            <i class="fas fa-cart-plus ml-2"></i>
                            أضف للسلة
                        </button>
                        <button @click="showModal = false"
                                class="btn btn-outline"
                                style="border-color: #d4af37; color: #d4af37;">
                            إغلاق
                        </button>
                    </div>
                </div>
            </template>
        </div>
    </div>

    <!-- Toast إضافة للسلة -->
    <div x-show="showToast"
         x-transition
         class="toast toast-top toast-center z-50">
        <div class="alert shadow-2xl" style="background: linear-gradient(135deg, #d4af37 0%, #ffd700 100%); color: #1a1a2e; border: none;">
            <i class="fas fa-check-circle text-2xl"></i>
            <span class="font-bold" x-text="toastMessage"></span>
        </div>
    </div>
</main>

<!-- الفوتر -->
<footer class="footer footer-center p-12 glass-card text-gray-300 relative overflow-hidden mt-12">
    <div class="mb-6 text-center">
        <div class="flex items-center justify-center gap-3 mb-2">
            <i class="fas fa-industry text-4xl" style="color:#d4af37;"></i>
            <span class="text-3xl font-bold gold-text">جال للتجارة</span>
        </div>
        <p class="text-gray-400 max-w-md mx-auto">شريكك الموثوق في توريد المعدات والمنتجات الصناعية بأعلى معايير الجودة</p>
    </div>
    <nav class="grid grid-flow-col gap-6 text-base">
        <a href="/productCatalog" class="link link-hover hover:text-[#d4af37]"><i class="fas fa-box-open ml-1"></i> المنتجات</a>
        <a href="/cart" class="link link-hover hover:text-[#d4af37]"><i class="fas fa-shopping-cart ml-1"></i> السلة</a>
        <a href="/contact" class="link link-hover hover:text-[#d4af37]"><i class="fas fa-phone-alt ml-1"></i> تواصل معنا</a>
    </nav>
    <div class="flex justify-center gap-6 text-2xl mt-6 mb-4">
        <a href="#" class="hover:text-blue-600"><i class="fab fa-facebook"></i></a>
        <a href="#" class="hover:text-pink-500"><i class="fab fa-instagram"></i></a>
        <a href="#" class="hover:text-green-500"><i class="fab fa-whatsapp"></i></a>
        <a href="#" class="hover:text-blue-700"><i class="fab fa-linkedin"></i></a>
    </div>
    <p class="text-gray-400 mt-4 text-center">© 2025 جال للتجارة والتوريدات — جميع الحقوق محفوظة</p>
</footer>

<script src="/js/productCatalog.js"></script>

</body>
</html>